using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Threading;
using System.Windows.Forms;
using System.IO.Ports;

namespace ResetSettings
{
    public partial class Form1 : Form
    {
        SerialPort PortUSB = new SerialPort();
        Dictionary<string, byte[]> MTU5 = new Dictionary<string, byte[]>()
        {
            { "mtu5 reset",new byte[]{ 0x55, 0xAA, 0x64, 0x26, 0x01, 0x53, 0x79, 0x73, 0x52, 0x65, 0x73, 0x65, 0x74, 0x4B, 0x66, 0x4F, 0x66, 0x66, 0x73, 0x65, 0x74, 0x3D, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x53 } },
            { "mtu5 chanel b pt1",new byte[]{ 0x55 ,0xAA ,0x64 ,0x26 ,0x01 ,0x55 ,0x61 ,0x72 ,0x74 ,0x73 ,0x58 ,0x31 ,0x30 ,0x34 ,0x4F ,0x70 ,0x4D ,0x6F ,0x64 ,0x65 ,0x3D ,0x34 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,0x3C } },
            { "mtu5 chanel b pt2",new byte[]{ 0x55 ,0xAA ,0xE4 ,0x26 ,01 ,0x55 ,0x61 ,0x72 ,0x74 ,0x73 ,0x58 ,0x31 ,0x30 ,0x34 ,0x4F ,0x70 ,0x4D ,0x6F ,0x64 ,0x65 ,0x3D ,0x30 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,00 ,0xB8 } },
            { "mtu5 chanel a pt1",new byte[]{ 0x55 ,0xAA ,0x64 ,0x26 ,0x01, 0x55, 0x61, 0x72, 0x74, 0x73, 0x54, 0x62, 0x75, 0x73, 0x4F, 0x70, 0x4D, 0x6F, 0x64, 0x65, 0x3D, 0x34, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xED} },
            { "mtu5 chanel a pt2",new byte[]{ 0x55, 0xAA, 0xE4, 0x26, 0x01, 0x55, 0x61, 0x72, 0x74, 0x73, 0x54, 0x62, 0x75, 0x73, 0x4F, 0x70, 0x4D, 0x6F, 0x64, 0x65, 0x3D, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x69 } },
            { "mtu5 kfa pt1",new byte[]{ 0x55, 0xAA, 0x64, 0x26, 0x01, 0x4B, 0x66, 0x41, 0x4D, 0x6F, 0x64, 0x65, 0x3D, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6F } } ,
            { "mtu5 kfa pt2",new byte[]{ 0x55, 0xAA, 0x64, 0x26, 0x01, 0x4B, 0x66, 0x41, 0x4D, 0x6F, 0x64, 0x65, 0x3D, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6F } } ,
            { "mtu5 kfb pt1",new byte[]{ 0x55, 0xAA, 0x64, 0x26, 0x01, 0x4B, 0x66, 0x42, 0x4D, 0x6F, 0x64, 0x65, 0x3D, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70 } } ,
            { "mtu5 kfb pt2",new byte[]{ 0x55, 0xAA, 0xE4, 0x26, 0x01, 0x4B, 0x66, 0x42, 0x4D, 0x6F, 0x64, 0x65, 0x3D, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0 } } ,
            { "mtu5 kfc pt1",new byte[]{ 0x55, 0xAA, 0x64, 0x26, 0x01, 0x4B, 0x66, 0x43, 0x4D, 0x6F, 0x64, 0x65, 0x3D, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x71 } } ,
            { "mtu5 kfc pt2",new byte[]{ 0x55, 0xAA, 0xE4, 0x26, 0x01, 0x4B, 0x66, 0x43, 0x4D, 0x6F, 0x64, 0x65, 0x3D, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF1} } ,            
            { "mtu5 set",new byte[]{ 0x55, 0xAA, 0x64, 0x26, 0x01, 0x53, 0x79, 0x73, 0x53, 0x65, 0x74, 0x4B, 0x66, 0x4F, 0x66, 0x66, 0x73, 0x65, 0x74, 0x3D, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C } },
        };

        Dictionary<string, byte[]> DIN32 = new Dictionary<string, byte[]>()
        {
            {"Reset1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Reset2", new byte[]{ 0x55, 0xAA, 0x09, 0x07, 0x01, 0x00, 0x11 } },            
            {"AC1.1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"AC1.2", new byte[]{ 0x55, 0xAA, 0x05, 0x08, 0x01, 0x00, 0x00, 0x0E } },
            {"AC1.3", new byte[]{ 0x55, 0xAA, 0x85, 0x08, 0x01, 0x00, 0x00, 0x8E } },
            {"AC2.1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"AC2.2", new byte[]{ 0x55, 0xAA, 0x05, 0x08, 0x02, 0x00, 0x00, 0x0F} },
            {"AC2.3", new byte[]{ 0x55, 0xAA, 0x85, 0x08, 0x02, 0x00, 0x00, 0x8F } },
            {"Set1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Set2", new byte[]{ 0x55, 0xAA, 0x09, 0x07, 0x02, 0x00, 0x12 } }
        };

        Dictionary<string, byte[]> MTU3_Set = new Dictionary<string, byte[]>()
        {
            {"Reset1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Reset2", new byte[]{ 0x55, 0xAA, 0x0D, 0x07, 0x01, 0x00, 0x15 } },
            {"AC1.1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"AC1.2", new byte[]{ 0x55, 0xAA, 0x08, 0x07, 0x01, 0x00, 0x10 } },
            {"AC1.3", new byte[]{ 0x55, 0xAA, 0x88, 0x07, 0x01, 0x00, 0x90 } },
            {"Set1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Set2", new byte[]{ 0x55, 0xAA, 0x0D, 0x07, 0x02, 0x00, 0x16 } }
        };

        Dictionary<string, byte[]> MTU3_Reset = new Dictionary<string, byte[]>()
        {
            {"Reset1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Reset2", new byte[]{ 0x55, 0xAA, 0x0D, 0x07, 0x01, 0x00, 0x15 } },
            {"AC1.1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"AC1.2", new byte[]{ 0x55, 0xAA, 0x08, 0x07, 0x01, 0x01, 0x11} },
            {"AC1.3", new byte[]{ 0x55, 0xAA, 0x88, 0x07, 0x01, 0x00, 0x90 } }
        };

        Dictionary<string, byte[]> RTU5_Set = new Dictionary<string, byte[]>()
        {
            {"Reset1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Reset2", new byte[]{ 0x55, 0xAA, 0x10, 0x07, 0x01, 0x00, 0x18 } },
            {"Reset3", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Reset4", new byte[]{ 0x55, 0xAA, 0x10, 0x07, 0x03, 0x00, 0x1A } },
            {"AC1.1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"AC1.2", new byte[]{ 0x55, 0xAA, 0x0B, 0x07, 0x01, 0x00, 0x13 } },
            {"AC1.3", new byte[]{ 0x55, 0xAA, 0x8B, 0x07, 0x01, 0x00, 0x93 } },
            {"ModBus1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"ModBus2", new byte[]{ 0x55, 0xAA, 0x01, 0x07, 0x04, 0x01, 0x0D } },
            {"ModBus3", new byte[]{ 0x55, 0xAA, 0x81, 0x07, 0x04, 0x00, 0x8C } },
            {"ModBus4", new byte[]{ 0x55, 0xAA, 0x01, 0x07, 0x08, 0x01, 0x11 } },
            {"ModBus5", new byte[]{ 0x55, 0xAA, 0x81, 0x07, 0x08, 0x00, 0x90 } },
            {"Set1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Set2", new byte[]{ 0x55, 0xAA, 0x10, 0x07, 0x02, 0x00, 0x19 } },
            {"Set3", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Set4", new byte[]{ 0x55, 0xAA, 0x10, 0x07, 0x04, 0x00, 0x1B } }
        };

        Dictionary<string, byte[]> RTU5_Reset = new Dictionary<string, byte[]>()
        {
            {"Reset1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Reset2", new byte[]{ 0x55, 0xAA, 0x10, 0x07, 0x01, 0x00, 0x18 } },
            {"Reset3", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"Reset4", new byte[]{ 0x55, 0xAA, 0x10, 0x07, 0x03, 0x00, 0x1A } },
            {"ModBus1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"ModBus2", new byte[]{ 0x55, 0xAA, 0x01, 0x07, 0x04, 0x02, 0x0E } },
            {"ModBus3", new byte[]{ 0x55, 0xAA, 0x81, 0x07, 0x04, 0x00, 0x8C } },
            {"ModBus4", new byte[]{ 0x55, 0xAA, 0x01, 0x07, 0x08, 0x01, 0x11 } },
            {"ModBus5", new byte[]{ 0x55, 0xAA, 0x81, 0x07, 0x08, 0x00, 0x90 } },
            {"AC1.1", new byte[]{ 0x55, 0xAA, 0xB3, 0x09, 0x00, 0x00, 0x00, 0x00, 0xBC } },
            {"AC1.2", new byte[]{ 0x55, 0xAA, 0x0B, 0x07, 0x01, 0x01, 0x14 } },
            {"AC1.3", new byte[]{ 0x55, 0xAA, 0x8B, 0x07, 0x01, 0x00, 0x93 } }
        };

        public Form1()
        {
            InitializeComponent();

            PortUSB.DataReceived += (s, e) => { PortUSB.DiscardInBuffer(); };
            this.KeyDown += (s, e) => { if (e.KeyCode == Keys.T) Test(null, null); };
        }

        private void Button1_Click(object sender, EventArgs e)
        {
            if (!PortUSB.IsOpen) return;
            button1.Enabled = false;
            button2.Enabled = false;
            switch (comboBox1.Text)
            {
                case "MTU5":
                    foreach (byte[] a in MTU5.Values)
                        { PortUSB.Write(a, 0, a.Length); Thread.Sleep(200); }
                    break;
                case "DIN32":
                    foreach (byte[] a in DIN32.Values)
                        { PortUSB.Write(a, 0, a.Length); Thread.Sleep(200); }
                    break;
                case "MTU3":
                    foreach (byte[] a in MTU3_Set.Values)
                        { PortUSB.Write(a, 0, a.Length); Thread.Sleep(200); }
                    break;
                case "RTU5":
                    foreach (byte[] a in RTU5_Set.Values)
                    { PortUSB.Write(a, 0, a.Length); Thread.Sleep(200); }
                    break;
            }
            button1.Enabled = true;
            button2.Enabled = true;
        }

        private void Timer1_Tick(object sender, EventArgs e)
        {
            if (!PortUSB.IsOpen)
            {
                try
                {
                    PortUSB.PortName = "COM7";
                    PortUSB.BaudRate = 2400;
                    PortUSB.Open();
                }
                catch (Exception err)
                { }
            }
            if (!PortUSB.IsOpen)
            {
                try
                {
                    PortUSB.PortName = "COM16";
                    PortUSB.BaudRate = 115200;
                    PortUSB.Open();
                }
                catch (Exception err) { }
            }

            if (PortUSB.IsOpen) { button1.Enabled = true; button2.Enabled = true; }
            else { button1.Enabled = false; button2.Enabled = false; }
        }

        private void Test(object sender, EventArgs e)
        {
            try
                {
                    PortUSB.PortName = "COM7";
                    PortUSB.BaudRate = 115200;
                    PortUSB.Open();
                }
                catch (Exception err)
                {
                    MessageBox.Show(err.Message, "error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }

        private void Button2_Click(object sender, EventArgs e)
        {
            if (!PortUSB.IsOpen) return;
            button1.Enabled = false;
            button2.Enabled = false;
            switch (comboBox1.Text)
            {
                case "MTU3":                    
                    foreach (byte[] a in MTU3_Reset.Values)
                        { PortUSB.Write(a, 0, a.Length); Thread.Sleep(200); }                    
                    break;
                case "RTU5":
                    foreach (byte[] a in RTU5_Reset.Values)
                    { PortUSB.Write(a, 0, a.Length); Thread.Sleep(200); }
                    break;
            }
            button1.Enabled = true;
            button2.Enabled = true;
        }
    }
}
